---
- name: apache | Install apache
  apt: pkg=apache2-mpm-prefork state=latest
  tags:
    - apache
    - common

- name: apache | Enable rewrite in apache
  command: a2enmod rewrite
  tags:
    - apache
    - common

- name: apache | Enable ssl in apache
  command: a2enmod ssl
  tags:
    - apache
    - common

- name: apache | Enable headers in apache
  command: a2enmod headers
  tags:
    - apache
    - common

- name: apache | Install php apache module
  apt: pkg=libapache2-mod-php5 state=latest
  tags:
    - apache
    - common

- name: apache | disable default sites
  shell: a2dissite 000-default.conf && a2dissite default-ssl.conf
  ignore_errors: yes
  tags:
    - apache
    - common

- name: apache | Clean sites available
  shell: rm -rf /etc/apache/sites-available/* /etc/apache2/sites-available/*
  tags:
    - apache
    - common
  

#- name: apache | Configura apache SSL
#  copy: src=files/apache/default-ssl dest=/etc/apache2/sites-available/default-ssl.conf force=yes
#  notify: reload apache
#  tags:
#    - apache
#    - common
#    - proxypass

- name: apache | Configure apache
  copy: src=files/apache/default dest=/etc/apache2/sites-available/default.conf force=yes
  notify: reload apache
  tags:
    - apache
    - common
    - proxypass

- name: apache | Enable site and restart
  shell: a2ensite default
  notify: restart apache
  ignore_errors: yes
  tags:
    - apache
    - common

#- name: apache | Enable ssl site and restart
#  shell: a2ensite default-ssl
#  notify: restart apache
#  ignore_errors: yes
#  tags:
#    - apache
#    - common


- name: apache | Generate storage folder
  command: mkdir -p /vagrant/web/storage creates=/vagrant/web/storage
  ignore_errors: yes
  tags:
    - apache
    - common

- name: apache | Change permisions of storage folder
  command: chmod -R 777 /vagrant/web/storage
  ignore_errors: yes
  tags:
    - apache
    - common

- name: apache | Generate cache folder
  command: mkdir -p {{ application_path }}/cache/ creates={{ application_path }}/cache/
  ignore_errors: yes
  tags:
    - apache
    - common

- name: apache | Change permisions of cache folder
  shell: chmod -R 777  {{ application_path }}/cache/
  tags:
    - apache
    - common

    
- name: apache | Creating CA folder
  shell: mkdir -p /etc/ssl/ca/ creates=/etc/ssl/ca/
  tags:
    - apache
    - common


- name: php upload | change post_max_size
  shell: sed -i 's/.*post_max_size =.*/post_max_size = 20M/g' /etc/php5/apache2/php.ini
  notify: restart apache
  ignore_errors: true
  tags:
    - php_modules
    - igbinary
    - common

- name: php upload | change upload_max_filesize
  shell: sed -i 's/.*upload_max_filesize =.*/upload_max_filesize = 20M/g' /etc/php5/apache2/php.ini
  notify: restart apache
  ignore_errors: true
  tags:
    - php_modules
    - igbinary
    - common
- name: php upload | change upload_max_filesize
  shell: php5enmod ldap
  notify: restart apache
  ignore_errors: true
  tags:
    - php_modules
    - ldap
    - common
    
